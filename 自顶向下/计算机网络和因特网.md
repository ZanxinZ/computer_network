# 1 计算机网络和因特网

## 1.3 网络核心

### 1.3.1 分组交换

端系统彼此交换**报文**（message）

**分组**（packet）：源端系统为了向目的端系统发送一个报文，源将报文划分为较小的数据块

源和目的地之间，每个分组都通过**通信链路**和**分组交换机**（packet switch）传送。

交换机：**路由器（router）**、**链路层交换机（link-layer switch）。**

1. **存储转发传输（store-and-forward transmission）**

   路由器转发时，接收并且缓存整个分组，**整个分组接收完成之后**，再开始转发。

   路由器的任务：将输入链路转移到另外一条唯一的链路。

   假设有3个分组进行传输。源与目的地中间只有一个路由器。

   时刻0：开始传输。

   时刻 L/R：路由器刚好传输了第一个分组并开始输出。 

   时刻 2L/R：目的地收到第一个分组，并且路由器已经收到第二个分组并开始输出第二个分组。

   时刻 3L/R：目的地收到第二个分组，并且路由器已经收到第三个分组并开始输出第三个分组。

   时刻 4L/R：目的地收到第三个分组。

   时延就是 L/R

   端到端时延（**传输时延**）
   $$
   d_{端到端}=N\frac L R（未考虑处理时延和传播时延）
   $$
   N-1：源与目的地之间有N-1台路由器。

   L：length 分组长度（比特）

   R：rate 链路传输速率（R 比特/秒）

   ***经过 N-1个路由器需要 N 个传输时间。***

2. **排队时延和分组丢失**

   每台分组交换机有多条链路与之相连，对于每条相连的链路，该分组交换机具有一个**输出缓存**（output buffer 也称为输出队列（output queue））。

   如果到达的分组发现该链路正忙于传输其他分组，那么该到达分组必须在<u>输出缓存</u>中等待。

   排队时延：在输出缓存中等待所产生。

   由于缓存空间有限，一个到达的分组可能发现缓存已经**被其他等待传输的分组完全充满**，将出现**分组丢失**（ <u>丢包</u> packet loss），**到达的分组**或者**已经排队的分组**将被遗弃。

3. 转发表和路由选择协议

   每一个端系统具有一个 IP 地址。

   每台路由器具有一个**转发表（forwarding table）**，用于将目的地址（或目的地址的一部分）映射成输出链路。当某个分组到达路由器时，路由器检查该分组的记录的 IP 地址，并用这个地址搜索转发表，找出一条适当链路，路由器将分组导向该出链路。

   **路由选择协议（routing protocol）**：自动地设置转发表。某个路由器选择协议可以决定从每台路由器到每个目的地的最短路径，并使用这些最短路径结果来配置路由器中的转发表。

### 1.3.2电路交换

发送方和接受方在通信过程中需要维护一个可靠连接，（为该连接预留带宽）。

端到端连接（end-to-end connection）

电路交换缺点：（静默期 silent period）有的时候，双方发送空信息也需要占用带宽，造成带宽资源浪费，而分组交换克服了这个缺点。

1. 电路交换中的复用

   - 频分复用（Frequency - Division Multiplexing）

     不同服务使用不同频段，该频段宽度称为**带宽（band-width）**

     电路网络：4kHz

     调频无线电台：88MHz~108MHz 每个电台被分配一个特定频段。

   - 时分复用（Time - Division Multiplexing）

     为每条电路分配一个编号，按照编号，每条电路在特定的时隙中周期性地获得所有带宽。

### 1.3.3 网络的网络

ISP（Internet Service Provider）

端系统，经过一个**接入ISP**与因ISP特网相连。该接入ISP使用的接入技术：DSL、电缆、FTTH、WiFi、蜂窝。

网络的网络

网络结构1：**单一的**全球传输 ISP 互联所有接入ISP。接入ISP（客户），全球传输ISP（提供商）

网络结构2：多个全球传输 ISP 互联所有接入ISP。（全球传输ISP之间必须互联通信）。

网络结构3：使用区域 ISP ，组建多层次的结构。

网络结构4：**比结构3增加了（存在点（Point of Presence）、多宿、对等、因特网交换点）**

**存在点 PoP**：提供商网络中一台或多台路由器群组。

**多宿（multi-home）**：任何ISP（除了第一层 ISP），可以与两个或以上提供商 ISP 连接。

**对等（peer）**：相同等级结构层次的邻近一对 ISP 可以对等，数据直接传输（通常不进行结算）。

**因特网交换点（Internet Exchange Point）**：IXP 

网络结构5：在结构3的顶部增加**内容提供商网络（content provider network）**，比如谷歌。

## 1.4  分组中的时延、丢包、吞吐量 

**吞吐量**：每秒能够传送的数据量。

### 1.4.1节点上的时延

- 节点总时延（total  nodal delay）

1.  **节点处理时延（nodal processing delay）**

   检查首部

   决定将该分组导向何处

   检查比特级别差错

2. **排队时延（queuing delay）**

   分组在链路上等待传输

3. **传输时延（传输、发射）（transmission delay）**

   将所有分组的比特推向链路所需时间。（存储转发传输引起）

   L/R ：L 分组的长度（bit），R 传输速率（bps）（bit per second）

4. **传播时延（propagation delay）**

   一个比特被推向链路之后，从路由器 A 到路由器  B **经过介质传播**，产生的时延。

$$
d_{nodal}=d_{proc}+d_{queue}+d_{trans}+d_{propa}
$$



### 1.4.2排队时延和丢包

分组到达队列的平均速率：a   （分组/秒   pkt/s）

流量强度（traffic intensity）：La/R 

L ：分组长度。 a：分组到达队列的平均速率（分组/秒：pkt/s）。R：传输速率(bps : bit/s)。

La：比特到达队列的平均速率。

La <= R：**进入队列的速率不能大于传输速率**，否则传输差会造成队列拥堵。

【设计系统时，流量强度不能大于1】

- 丢包

  到达的分组发现队列已满，路由器则丢弃（drop）该分组。

  分组丢失的比例随着流量强度的增加而增加。

### 1.4.3端到端时延

$$
d_{end-end} = N(d_{proc}+d_{trans}+d_{prop})
$$

### 1.4.4吞吐量

考虑从主机 A 到主机 B 传送一个大文件。

- 瞬时吞吐量 instantaneous  throughput

  主机 B 接收到该文件的速率（bps）

- 平均吞吐量 average throughput

  F/T bps

  大文件的所有比特 F ，传送总时间 T 

- 多条串联链路上的吞吐量

  链路 Rs，链路 Rc

  总体吞吐量 min{Rs，Rc} ，瓶颈链路（bottleneck link）的传输速率。

## 1.5 协议层次及其服务模型

### 1.5.1 分层的体系结构

1. 协议分层

   **协议栈（protocol stack）**：各层的所有协议。

   因特网的协议栈：5个层次，**物理层，链路层，网络层，传输层，应用层**

   - **应用层**

     网络应用程序和它们的应用层协议存留的地方。HTTP 、SMPT、FTP、DNS。

     分组：**报文（message）**：端系统与另一个端系统中的应用程序交换信息分组，这种信息分组称为报文。

   - **运输层**

     协议：TCP、UDP。

     TCP：面向连接，用于保证可靠性和流量控制而维护的状态信息。这些信息包括Socket，序列号，窗口大小，称之为连接。

     UDP：为应用程序提供无连接服务。没有可靠性、没有流量控制、没有拥塞控制。

     分组：**报文段（segment）**

   - **网络层**

     也称为 IP 层。

     协议：IP、路由选择协议、网际协议

     分组：**数据报（datagram）**

   - **链路层**

     协议：以太网、WiFi、电缆接入网的 DOCSIS 协议。

     <u>数据传输通常经过多条链路，一个数据报可能被沿途不同的链路层协议处理。即是：网络层将受到不同的链路层协议的不同服务。</u>

     分组：**帧（frame）**

     任务：将整个帧从一个网络元素移动到邻近的一个网络元素。

   - **物理层**

     协议：双铜绞线、单模光纤

     任务：将帧中的一个个比特从一个节点移动到下一个节点。

2. OSI 模型

   OSI（开发系统互联）模型：由 ISO 组织提出，七层。

   应用层、表示层、会话层、传输层、网络层、链路层、物理层。

### 1.5.2 封装

主机：应用层、运输层、网络层、链路层、物理层。

路由器：网络层、链路层、物理层。

链路层交换机：链路层、物理层。

分组：**首部字段**+**有效载荷字段（payload filed）**

## 1.6 面对攻击的网络

1. **攻击方把有害程序放入计算机**

   自我复制（self-replicating）的恶意软件：

   - 病毒（virus）需要用户交互触发。
   - 蠕虫（worm）无需交互就可以进入设备。

2. **攻击服务器和网络基础设施**

   拒绝服务攻击（Denial-of-Service （DoS）attack）

   - 弱点攻击：向运行着易受攻击的应用程序或操作系统的主机发送制作精细的报文。可能造成服务器停止运行甚至主机崩溃。
   - 带宽洪泛：攻击者向目标主机发送大量分组，分组数量之多使得目标主机接入链路变得拥塞。
   - 连接洪泛：攻击者在目标主机中创建大量半开或全开 TCP 连接。

   分布式DoS（Distributed Dos）DDoS。

3. **嗅探分组**

   分组嗅探器（packet sniffer）

4. **伪装成计算机信任的人**

   IP 哄骗（IP spoofing）：解决方法：端点鉴别（一种使我们能够确信一个报文源自我们认为它应当来自的地方）

# 问题

1.1 

R1 主机和端系统的不同？

主机是管理者，端系统被管理；主机是共享者，端系统是使用者。

端系统：PC、智能手机	、Web服务器、电子邮件服务

